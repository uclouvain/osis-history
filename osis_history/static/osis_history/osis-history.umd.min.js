(function(l,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("@vue/runtime-dom"),require("vue"),require("vue-i18n")):typeof define=="function"&&define.amd?define(["exports","@vue/runtime-dom","vue","vue-i18n"],a):(l=typeof globalThis<"u"?globalThis:l||self,a(l.OsisHistory={},l.Vue,l.Vue,l.VueI18n))})(this,function(l,a,e,y){"use strict";function m(t){return t?t.toString().replace(/\r\n|\r/g,`
`).replace(/</g,"&lt;").replace(/>/g,"&gt;").split(/\n{2,}/g).map(o=>"<p>"+o.replace(/\n/g,"<br />")+"</p>","").join(`

`):""}const h=e.defineComponent({name:"TableHistory",props:{entries:{type:Array,required:!0},onItemRender:{type:Function,default:null},onHeadersRender:{type:Function,default:null},onHistoryEmptyRender:{type:Function,default:null}},data:function(){return{renderedHeaders:this.onHeadersRender?this.onHeadersRender(this.entries):"",renderedRows:this.onItemRender?this.entries.map(this.onItemRender).join(""):[],renderedEmpty:this.onHistoryEmptyRender?this.onHistoryEmptyRender("table"):""}},methods:{filterXssAndFormat:m}}),x="",c=(t,n)=>{const o=t.__vccOpts||t;for(const[s,d]of n)o[s]=d;return o},k={class:"table table-striped"},f={key:0},_=["innerHTML"],E={key:2},g=[".inner-html"],u=["innerHTML"],B=["innerHTML"],H={key:5},T={colspan:"3"};function $(t,n,o,s,d,p){return e.openBlock(),e.createElementBlock("table",k,[t.onHeadersRender?(e.openBlock(),e.createElementBlock("thead",{key:1,innerHTML:t.renderedHeaders},null,8,_)):(e.openBlock(),e.createElementBlock("thead",f,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,e.toDisplayString(t.$t("date")),1),e.createElementVNode("th",null,e.toDisplayString(t.$t("message")),1),e.createElementVNode("th",null,e.toDisplayString(t.$t("author")),1)])])),t.entries.length&&!t.onItemRender?(e.openBlock(),e.createElementBlock("tbody",E,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.entries,(r,i)=>(e.openBlock(),e.createElementBlock("tr",{key:i},[e.createElementVNode("td",null,e.toDisplayString(r.created),1),e.createElementVNode("td",{".inner-html":t.filterXssAndFormat(r.message)},null,8,g),e.createElementVNode("td",null,e.toDisplayString(r.author),1)]))),128))])):t.entries.length&&t.onItemRender?(e.openBlock(),e.createElementBlock("tbody",{key:3,innerHTML:t.renderedRows},null,8,u)):t.onHistoryEmptyRender?(e.openBlock(),e.createElementBlock("tbody",{key:4,innerHTML:t.renderedEmpty},null,8,B)):(e.openBlock(),e.createElementBlock("tbody",H,[e.createElementVNode("tr",null,[e.createElementVNode("td",T,e.toDisplayString(t.$t("no_entry")),1)])]))])}const b=c(h,[["render",$]]),R=e.defineComponent({name:"TimelineHistory",props:{entries:{type:Array,required:!0},horizontal:{type:Boolean,default:!1},onItemRender:{type:Function,default:null},onHistoryEmptyRender:{type:Function,default:null}},data:function(){const t=this.horizontal?"horizontal":"vertical";return{renderedItems:this.onItemRender?this.entries.map(this.onItemRender).join(""):[],renderedEmpty:this.onHistoryEmptyRender?this.onHistoryEmptyRender(t):""}}}),v="",V={key:0},N=["innerHTML"],z={key:1},I=e.createElementVNode("div",{class:"timeline-badge"},null,-1),F={class:"timeline-panel"},M={class:"timeline-heading"},S={class:"h4"},L=e.createElementVNode("span",{class:"glyphicon glyphicon-time"},null,-1),C=e.createElementVNode("span",{class:"glyphicon glyphicon-user"},null,-1),D=["innerHTML"],w=["innerHTML"];function A(t,n,o,s,d,p){return t.entries.length?(e.openBlock(),e.createElementBlock("div",z,[t.onItemRender?(e.openBlock(),e.createElementBlock("ul",{key:1,class:e.normalizeClass(["timeline",{"timeline-horizontal":t.horizontal}]),innerHTML:t.renderedItems},null,10,w)):(e.openBlock(),e.createElementBlock("ul",{key:0,class:e.normalizeClass(["timeline",{"timeline-horizontal":t.horizontal}])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.entries,(r,i)=>(e.openBlock(),e.createElementBlock("li",{key:i,class:"timeline-item"},[I,e.createElementVNode("div",F,[e.createElementVNode("div",M,[e.createElementVNode("h3",S,[L,e.createTextVNode(" "+e.toDisplayString(r.created)+" - ",1),C,e.createTextVNode(" "+e.toDisplayString(r.author),1)])]),e.createElementVNode("div",{class:"timeline-body",innerHTML:r.message},null,8,D)])]))),128))],2))])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[t.onHistoryEmptyRender?(e.openBlock(),e.createElementBlock("div",{key:1,innerHTML:t.renderedEmpty},null,8,N)):(e.openBlock(),e.createElementBlock("p",V,e.toDisplayString(t.$t("no_entry")),1))],64))}const q=c(R,[["render",A]]),j=e.defineComponent({name:"HistoryViewer",components:{TableHistory:b,TimelineHistory:q},props:{url:{type:String,required:!0},tags:{type:String,default:""},modes:{type:Array,default:()=>["table","vertical","horizontal"]},defaultMode:{type:String,default:"table"},onItemRenderTable:{type:Function,default:null},onHeadersRenderTable:{type:Function,default:null},onItemRenderHorizontalTimeline:{type:Function,default:null},onItemRenderVerticalTimeline:{type:Function,default:null},onHistoryEmptyRender:{type:Function,default:null}},data(){let t=this.defaultMode;return this.modes.includes(this.defaultMode)||(t=this.modes[0]),{mode:t==="table"?"TableHistory":"TimelineHistory",horizontal:t==="horizontal",entries:[],error:"",loading:!0}},mounted(){this.loadEntries()},methods:{loadEntries:async function(){try{const t=await fetch(`${this.url}${this.tags?"?tags="+this.tags:""}`);t.status===200?this.entries=await t.json():this.error=t.statusText}catch(t){this.error=t.message}this.loading=!1}}}),ee="",O={key:0,class:"btn-group","data-toggle":"buttons"},X=[e.createElementVNode("input",{type:"radio",name:"mode"},null,-1),e.createElementVNode("span",{class:"fa fa-table"},null,-1)],P=[e.createElementVNode("input",{type:"radio",name:"mode"},null,-1),e.createElementVNode("span",{class:"fas fa-ellipsis-v"},null,-1)],G=[e.createElementVNode("input",{type:"radio",name:"mode"},null,-1),e.createElementVNode("span",{class:"fa fa-ellipsis-h"},null,-1)],J={class:"viewport"},K={key:0,class:"spinner"},Q={key:1,class:"text-danger"};function U(t,n,o,s,d,p){return e.openBlock(),e.createElementBlock(e.Fragment,null,[t.modes.length>1?(e.openBlock(),e.createElementBlock("div",O,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.modes,r=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:r},[r==="table"?(e.openBlock(),e.createElementBlock("label",{key:0,class:e.normalizeClass(["btn btn-default",{active:t.mode==="TableHistory"}]),onClick:n[0]||(n[0]=i=>t.mode="TableHistory")},X,2)):r==="vertical"?(e.openBlock(),e.createElementBlock("label",{key:1,class:e.normalizeClass(["btn btn-default",{active:t.mode==="TimelineHistory"&&t.horizontal===!1}]),onClick:n[1]||(n[1]=i=>{t.mode="TimelineHistory",t.horizontal=!1})},P,2)):(e.openBlock(),e.createElementBlock("label",{key:2,class:e.normalizeClass(["btn btn-default",{active:t.mode==="TimelineHistory"&&t.horizontal===!0}]),onClick:n[2]||(n[2]=i=>{t.mode="TimelineHistory",t.horizontal=!0})},G,2))],64))),128))])):e.createCommentVNode("",!0),e.createElementVNode("div",J,[t.loading?(e.openBlock(),e.createElementBlock("span",K)):t.error?(e.openBlock(),e.createElementBlock("span",Q,e.toDisplayString(t.error),1)):(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.mode),{key:2,entries:t.entries,horizontal:t.horizontal,"on-item-render":t.mode==="TableHistory"?t.onItemRenderTable:t.horizontal?t.onItemRenderHorizontalTimeline:t.onItemRenderVerticalTimeline,"on-headers-render":t.onHeadersRenderTable,"on-history-empty":t.onHeadersRenderTable},null,40,["entries","horizontal","on-item-render","on-headers-render","on-history-empty"]))])],64)}const W=c(j,[["render",U]]),Y={en:{date:"Date",message:"Message",author:"Author",no_entry:"No history entry yet."},"fr-be":{date:"Date",message:"Message",author:"Auteur",no_entry:"Aucune entrÃ©e d'historique pour le moment."}},Z=y.createI18n({locale:document.documentElement.lang||"en",messages:Y});document.querySelectorAll(".history-viewer").forEach(t=>{const n={url:"",...t.dataset};for(const o of["onItemRenderTable","onHeadersRenderTable","onItemRenderHorizontalTimeline","onItemRenderVerticalTimeline","onHistoryEmptyRender"])if(o in n){const s=n[o];n[o]=window[s]}typeof t.dataset.modes<"u"&&(n.modes=t.dataset.modes.split(",")),a.createApp(W,n).use(Z).mount(t)}),l.filterXssAndFormat=m,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=osis-history.umd.min.js.map
